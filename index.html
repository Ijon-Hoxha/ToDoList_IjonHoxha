<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="style.css">
    <title>ToDoList</title>
</head>
<body>
<main>
    <h1>ToDoList</h1>
    <p id="open"></p>
    <p id="close"></p>

    <input type="text" id="number1">

    <button id="add">Add Task</button>
    
    <ul id="history"></ul>
    <button id="delete">Delete Tasks</button>
</main>
</body>
</html>

<script>
    let history = [];
    let openCount = 0;
    let closedCount = 0;

    function add(){
        let n1 = document.getElementById("number1").value;
        history.push({"text": n1, "status": "open"});
        openCount++;
        updateHistoryList();
    }
    function updateHistory() {
        
        localStorage.setItem("history", JSON.stringify(history));
        localStorage.setItem("openCount", JSON.stringify(openCount));
        localStorage.setItem("closedCount", JSON.stringify(closedCount));

        
        let historyList = document.getElementById("history");
        historyList.innerHTML = "";
        
        for (let  i= 0;  i<history.length; i++) {
            let item = document.createElement("li");
            item.addEventListener("click", checkItem);
            item.innerHTML = history[i].text;
            if (history[i].status != "open") {
                item.style.textDecoration = "line-through";
            }
            historyList.append(item);
        }
        document.getElementById("open").innerHTML = openCount + "tasks open!";
        document.getElementById("close").innerHTML = closedCount + "tasks closed!";
    }
    function checkItem(event) {
        let currentCalcString = event.target.innerHTML;
        let index = history.map(i=>i.text).indexOf(currentCalcString);
        if (history[index].status == "open") {
            history[index].status = "closed";
            closedCount++;
        } else {
            history[index].status = "open";
            openCount++;
        }
        updateHistoryList();
        if((history.length == closedCount) && history.length > 0){
            alert("All tasks finished! Good Job! ^-^");
        }
    }
    function deleteList() {
        history = [];
        openCount = 0;
        closedCount = 0;
        updateHistoryList();
    }
    function loadHistory() {
        history = JSON.parse(localStorage.getItem("history"));
        openCount = JSON.parse(localStorage.getItem("openCount"));
        closedCount = JSON.parse(localStorage.getItem("closedCount"));

        updateHistoryList();
    }

    document.getElementById("add").addEventListener("click", add);
    document.getElementById("delete").addEventListener("click", deleteList);
    document.addEventListener("DOMContentLoaded", loadHistory);

</script>